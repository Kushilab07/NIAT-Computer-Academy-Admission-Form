<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NIAT Admission Portal</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Lato:wght@400;700&family=Montserrat:wght@600;800&display=swap" rel="stylesheet">
    
    <style>
      /* THEME: Ink Wash */
      body { font-family: 'Lato', sans-serif; background-color: #CBCBCB; margin: 0; padding: 40px 15px; color: #4A4A4A; }
      .container { max-width: 650px; margin: 0 auto; background: #FFFFE3; padding: 40px; border-radius: 4px; box-shadow: 0 10px 25px rgba(0,0,0,0.15); border-top: 6px solid #6D8196; }
      
      /* --- HEADER BRANDING --- */
      .institute-header { text-align: center; border-bottom: 2px solid #6D8196; padding-bottom: 20px; margin-bottom: 30px; }
      .inst-name { font-family: 'Montserrat', sans-serif; font-size: 24px; font-weight: 800; color: #2c3e50; text-transform: uppercase; line-height: 1.3; margin-bottom: 5px; }
      .inst-iso { font-family: 'Lato', sans-serif; font-size: 14px; font-weight: bold; color: #c0392b; margin-bottom: 5px; }
      .inst-reg { font-family: 'Lato', sans-serif; font-size: 13px; color: #4A4A4A; font-weight: 600; }
      .inst-addr { font-family: 'Lato', sans-serif; font-size: 13px; color: #666; margin-top: 5px;}

      /* Section Headers */
      .section-header { 
        font-family: 'Montserrat', sans-serif; 
        color: #4A4A4A; 
        font-size: 18px; 
        font-weight: 700;
        text-transform: uppercase;
        border-bottom: 2px solid #CBCBCB; 
        padding-bottom: 5px; 
        margin-top: 35px; 
        margin-bottom: 20px; 
      }
      
      /* Input Styles */
      input, select, textarea { width: 100%; padding: 15px; margin-bottom: 15px; border: 1px solid #CBCBCB; background-color: #F4F8FB; border-radius: 2px; box-sizing: border-box; font-family: 'Lato', sans-serif; transition: border-color 0.3s; }
      input::placeholder, textarea::placeholder { color: #999; } 
      input:focus, select:focus, textarea:focus { outline: none; border-color: #6D8196; border-width: 2px; }
      input[readonly] { background-color: #e9ecef; color: #4A4A4A; font-weight: bold; cursor: not-allowed; border: 1px dashed #ccc; }
      textarea { resize: vertical; height: 80px; }

      .row { display: flex; gap: 20px; } .col { flex: 1; }
      @media (max-width: 600px) { .row { flex-direction: column; gap: 0; } }
      .hidden { display: none; }
      
      /* Buttons */
      .btn-primary { width: 70%; background-color: #6D8196; color: #FFFFE3; border: none; padding: 16px; font-size: 18px; font-weight: bold; border-radius: 50px; cursor: pointer; font-family: 'Montserrat', sans-serif; margin-top: 10px;}
      .btn-google { background-color: #DB4437; color: white; margin-top: 30px; } 
      .btn-primary:disabled { background-color: #ccc; cursor: wait; }

      /* Pay Button */
      .pay-btn { display: block; width: 100%; text-align: center; background-color: #4A4A4A; color: #FFFFE3; text-decoration: none; padding: 15px; border-radius: 4px; font-weight: bold; margin-bottom: 20px; box-sizing: border-box; }

      /* Profile Box & Logout */
      .user-profile { 
        text-align: center; 
        margin-bottom: 20px; 
        padding: 15px; 
        background: rgba(109, 129, 150, 0.1); 
        border-radius: 4px; 
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      .user-info { text-align: left; }
      .logout-btn {
        background: none;
        border: 1px solid #6D8196;
        color: #6D8196;
        padding: 5px 15px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 12px;
        font-weight: bold;
      }
      .logout-btn:hover { background: #6D8196; color: #fff; }

      /* Payment Options Styling */
      .payment-options { display: flex; gap: 20px; margin-bottom: 20px; justify-content: center; }
      .radio-label { 
        display: flex; align-items: center; cursor: pointer; font-weight: bold; background: white; padding: 10px 20px; border: 1px solid #CBCBCB; border-radius: 4px; flex: 1; justify-content: center;
      }
      .radio-label input { width: auto; margin: 0 10px 0 0; }
      .radio-label:hover { border-color: #6D8196; }

      /* Submit Button Animation */
      .submit-wrapper { display: flex; justify-content: center; margin-top: 40px; height: 60px; }
      #submit-btn { 
        position: relative; width: 150px; height: 50px; background: none; border: 4px solid #6D8196; color: #6D8196; border-radius: 50px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: width 0.3s ease, border-color 0.3s ease; font-family: 'Montserrat', sans-serif; font-size: 18px; font-weight: bold; letter-spacing: 1px; 
      }
      #submit-btn span, #submit-btn svg { position: absolute; transition: opacity 0.3s; }
      #submit-btn svg { opacity: 0; fill: transparent; width: 24px; height: 24px; }
      #submit-btn.loading { 
        width: 50px; border: 4px solid transparent; border-left: 4px solid #6D8196; border-bottom: 4px solid #6D8196; color: transparent; animation: spin 1s linear infinite; 
      }
      #submit-btn.loading span { opacity: 0; }
      #submit-btn.success { width: 50px; border-color: #28a745; background-color: #fff; }
      #submit-btn.success span { opacity: 0; }
      #submit-btn.success svg { opacity: 1; fill: #28a745; transition: fill 0.3s ease; }
      
      .serial-loader {
        border: 4px solid rgba(255, 255, 227, 0.3); border-top: 4px solid #FFFFE3; border-radius: 50%; width: 30px; height: 30px; animation: spin 1s linear infinite; display: inline-block;
      }
      
      @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
      .noselect { user-select: none; }
      .file-label { display: block; font-size: 0.85em; font-weight: bold; margin-bottom: 5px; color: #6D8196; }

    </style>
</head>
<body>

    <div class="container">
      
      <div class="institute-header">
        <div class="inst-name">NIAT Computer Academy &<br>Vocational Training Institute</div>
        <div class="inst-iso">AN ISO 9001:2015 CERTIFIED INSTITUTE</div>
        <div class="inst-reg">Regd. Under MSME Govt. of India (No-AS-23-0000097)</div>
        <div class="inst-addr">Branch: Arikuchi & Bagals Road Chowk, Nalbari</div>
      </div>

      <div id="login-section" style="text-align: center; padding: 40px 0;">
        <p>Please sign in with your Google Account to begin.</p>
        <button id="google-login-btn" class="btn-primary btn-google">Sign in with Google</button>
      </div>

      <div id="form-section" class="hidden">
        
        <h2 style="font-family:'Montserrat', sans-serif; text-align:center; margin-bottom:15px; color:#4A4A4A;">Registration Form</h2>

        <div class="user-profile">
            <div class="user-info">
              <span id="user-display-name" style="font-weight:bold;">User</span>
              <br><small style="color:#6D8196;">(Logged In)</small>
            </div>
            <button id="logout-btn-top" class="logout-btn">Sign Out</button>
        </div>

        <form id="admissionForm">
            <div class="section-header">1. Personal Information</div>
            <input type="text" name="studentName" placeholder="Student Name" required>
            <input type="text" name="fatherName" placeholder="Father's Name" required>
            <div class="row">
                <div class="col"><input type="email" id="email-field" name="email" placeholder="Email Address" readonly required title="This email is linked to your login"></div>
                <div class="col"><input type="tel" name="contact" placeholder="Contact Number" pattern="[0-9]{10}" required></div>
            </div>

            <div class="section-header">2. Address</div>
            <div class="row"><div class="col"><input type="text" name="village" placeholder="Village" required></div><div class="col"><input type="text" name="po" placeholder="Post Office" required></div></div>
            <div class="row"><div class="col"><input type="text" name="district" placeholder="District" required></div><div class="col"><input type="number" name="pin" placeholder="PIN Code" required></div></div>

            <div class="section-header">3. Education & Occupation</div>
            <input type="text" name="qualification" placeholder="Last Qualification" required>
            <input type="text" name="activity" placeholder="Present Activity" required>

            <div class="section-header">4. Select Course</div>
            
            <select name="course3m" class="course-select">
                <option value="">-- Three Month Course --</option>
                <option value="Basic Of Computer">Basic Of Computer</option>
                <option value="DTP">DTP</option>
                <option value="Tally Prime & Accounting">Tally Prime & Accounting</option>
                <option value="Advance Excel with MIS Report">Advance Excel with MIS Report</option>
                <option value="AI/ML using Python">AI/ML using Python</option>
                <option value="Digital Marketing">Digital Marketing</option>
                <option value="Communication skill & Personality Dev">Communication skill & Personality Dev</option>
                <option value="Office management with Google workspace">Office management with Google workspace</option>
                <option value="SDP(Skill Development Programme)">SDP(Skill Development Programme)</option>
            </select>
            
            <select name="course6m" class="course-select">
                <option value="">-- Six Month Course --</option>
                <option value="Diploma in Computer Application">Diploma in Computer Application</option>
                <option value="Advance Tally Prime with GST">Advance Tally Prime with GST</option>
                <option value="Diploma in Computer Application in Business (CAB)">Diploma in Computer Application in Business (CAB)</option>
                <option value="Personal Financial Literacy & Stock Market">Personal Financial Literacy & Stock Market</option>
                <option value="Back office Management & MIS Report">Back office Management & MIS Report</option>
                <option value="Data Analyst with Al Technology">Data Analyst with Al Technology</option>
            </select>
            
            <select name="course1y" class="course-select">
                <option value="">-- One Year Course --</option>
                <option value="Advance Diploma in Computer Application">Advance Diploma in Computer Application</option>
                <option value="Post Graduate Diploma in Computer Application">Post Graduate Diploma in Computer Application</option>
                <option value="Advance Diploma in Financial Accounting with Taxation">Advance Diploma in Financial Accounting with Taxation</option>
            </select>
            
            <select name="courseSp" class="course-select">
                <option value="">-- Special Course --</option>
                <option value="Advance Diploma in Computer Application with Al Technology">Advance Diploma in Computer Application with Al Technology</option>
                <option value="Diploma in Computer Teacher Training">Diploma in Computer Teacher Training</option>
                <option value="Master Diploma in Computer Application">Master Diploma in Computer Application</option>
            </select>

            <div class="section-header">5. Documents</div>
            <span class="file-label">Passport Sized Photo (less than 1MB)</span><input type="file" id="photoFile" accept="image/*" required>
            <span class="file-label">Last Qualification Document (less than 1MB)</span><input type="file" id="docFile" accept="image/*,.pdf" required>

            <div class="section-header">6. Payment</div>
            <p style="text-align:center; color:#4A4A4A; margin-bottom:15px; font-weight:bold;">
                Please pay admission fee <span style="font-size: 1.4em; color: #2c3e50;">Rs 1000/-</span> Only.
            </p>

            <div class="payment-options">
                <label class="radio-label">
                    <input type="radio" name="payMode" value="Online" checked> Pay Online
                </label>
                <label class="radio-label">
                    <input type="radio" name="payMode" value="Cash"> Pay with Cash
                </label>
            </div>
            
            <div id="online-payment-section">
                <a href="upi://pay?pa=indkiller192@oksbi&pn=Kushilab%20Deva%20Sarma&am=1&cu=INR&tn=Admission%20Fee" class="pay-btn">Click to Pay via UPI App</a>
                <span class="file-label">Upload Payment Screenshot (less than 1MB)</span>
                <input type="file" id="payFile" accept="image/*">
            </div>

            <div class="section-header">7. Additional Notes</div>
            <textarea name="notes" placeholder="Any message for the administrator? (Optional)"></textarea>

            <div class="submit-wrapper">
              <button type="submit" id="submit-btn" class="noselect">
                <span>SUBMIT</span>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 11c2.761.575 6.312 1.688 9 3.438 3.157-4.23 8.828-8.187 15-11.438-5.861 5.775-10.711 12.328-14 18.917-2.651-3.766-5.547-7.271-10-10.917z"/></svg>
              </button>
            </div>
        </form>
      </div>

      <div id="success-view" class="hidden" style="text-align:center;">
        <h2 style="color:#6D8196;">Thank you for enrolling.</h2>
        <p>Your Registration Number:</p>
        
        <div id="serial-display" style="background:#4A4A4A; color:#FFFFE3; padding:15px; font-size:32px; display:inline-block; margin:20px; min-width: 100px;">
          </div>
        
        <p>A confirmation email has been sent.</p>
        
        <button id="logout-btn-bottom" class="btn-primary" style="background:#4A4A4A; margin-top:30px;">Sign Out & Close</button>
      </div>

    </div>

    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
      import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

      const firebaseConfig = {
        apiKey: "AIzaSyCWpp7vH0FAubDAW1Gvw5LMmtEqfMIq4u0",
        authDomain: "niat-admission-form.firebaseapp.com",
        projectId: "niat-admission-form",
        storageBucket: "niat-admission-form.firebasestorage.app",
        messagingSenderId: "907218345703",
        appId: "1:907218345703:web:57e6dd3d74baab2f190c42",
        measurementId: "G-YPCVGYS7L9"
      };

      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);
      const provider = new GoogleAuthProvider();
      
      const loginBtn = document.getElementById('google-login-btn');
      const logoutBtnTop = document.getElementById('logout-btn-top');
      const logoutBtnBottom = document.getElementById('logout-btn-bottom');

      if(loginBtn) {
        loginBtn.addEventListener('click', () => {
          signInWithPopup(auth, provider).catch((error) => { alert("Login Failed: " + error.message); });
        });
      }

      const handleLogout = () => {
        signOut(auth).then(() => {
          document.getElementById('form-section').classList.add('hidden');
          document.getElementById('success-view').classList.add('hidden');
          document.getElementById('login-section').classList.remove('hidden');
          const form = document.getElementById('admissionForm');
          if(form) form.reset();
          // Reset visibility of payment section to default
          document.getElementById('online-payment-section').classList.remove('hidden');
          const btn = document.getElementById('submit-btn');
          if(btn) {
              btn.classList.remove('loading', 'success');
              btn.disabled = false;
          }
        }).catch((error) => {
          alert("Error signing out: " + error.message);
        });
      };

      if(logoutBtnTop) logoutBtnTop.addEventListener('click', handleLogout);
      if(logoutBtnBottom) logoutBtnBottom.addEventListener('click', handleLogout);

      onAuthStateChanged(auth, (user) => {
        if (user) {
          document.getElementById('login-section').classList.add('hidden');
          if(document.getElementById('success-view').classList.contains('hidden')){
             document.getElementById('form-section').classList.remove('hidden');
          }
          const emailF = document.getElementById('email-field');
          const nameF = document.getElementById('user-display-name');
          if(emailF) emailF.value = user.email;
          if(nameF) nameF.innerText = user.displayName;
        } else {
          document.getElementById('login-section').classList.remove('hidden');
          document.getElementById('form-section').classList.add('hidden');
        }
      });
    </script>

    <script>
      const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyPAb-yZwLJZb_Bf-99zDJ9vVMPl2X3aANHMT9JASIllnNBkMcl9pxWnZaN2Fy_IEzf/exec"; 
      const MAX_SIZE = 2 * 1024 * 1024; // 2MB Limit

      function checkFileSize(fileInput) {
        if(fileInput.files.length > 0) {
            if(fileInput.files[0].size > MAX_SIZE) {
                alert("File is too big! Max size is 2MB.");
                fileInput.value = ""; 
            }
        }
      }
      
      const photoF = document.getElementById('photoFile');
      const docF = document.getElementById('docFile');
      const payF = document.getElementById('payFile');

      if(photoF) photoF.addEventListener('change', function() { checkFileSize(this) });
      if(docF) docF.addEventListener('change', function() { checkFileSize(this) });
      if(payF) payF.addEventListener('change', function() { checkFileSize(this) });

      // --- PAYMENT MODE TOGGLE ---
      const payRadios = document.querySelectorAll('input[name="payMode"]');
      const onlineSection = document.getElementById('online-payment-section');
      
      payRadios.forEach(radio => {
          radio.addEventListener('change', function() {
              if(this.value === 'Online') {
                  onlineSection.classList.remove('hidden');
              } else {
                  onlineSection.classList.add('hidden');
              }
          });
      });

      const selects = document.querySelectorAll('.course-select');
      selects.forEach(select => {
        select.addEventListener('change', function() {
          if(this.value !== "") selects.forEach(other => { if(other !== this) other.value = ""; });
        });
      });

      // --- SUBMIT LOGIC ---
      const form = document.getElementById('admissionForm');
      if (form) {
          form.addEventListener('submit', function(e) {
            e.preventDefault(); 
            
            // Check Payment Mode
            const payMode = document.querySelector('input[name="payMode"]:checked').value;
            
            // Validation: If Online, Payment screenshot is mandatory
            if (payMode === 'Online') {
                const payFile = document.getElementById('payFile');
                if(payFile.files.length === 0) {
                    alert("Please upload the Payment Screenshot.");
                    return;
                }
            }

            var btn = document.getElementById('submit-btn');
            if(btn) {
                btn.disabled = true; 
                btn.classList.add('loading'); 
            }

            const filePromises = [
                getFileData('photoFile'), 
                getFileData('docFile'), 
                // Only upload payFile if Online
                (payMode === 'Online') ? getFileData('payFile') : Promise.resolve({data:"", name:""})
            ];

            Promise.all(filePromises).then(files => {
                var formData = {
                    studentName: document.getElementsByName('studentName')[0].value,
                    fatherName: document.getElementsByName('fatherName')[0].value,
                    email: document.getElementById('email-field').value, 
                    contact: document.getElementsByName('contact')[0].value,
                    village: document.getElementsByName('village')[0].value,
                    po: document.getElementsByName('po')[0].value,
                    district: document.getElementsByName('district')[0].value,
                    pin: document.getElementsByName('pin')[0].value,
                    qualification: document.getElementsByName('qualification')[0].value,
                    activity: document.getElementsByName('activity')[0].value,
                    course3m: document.getElementsByName('course3m')[0].value,
                    course6m: document.getElementsByName('course6m')[0].value,
                    course1y: document.getElementsByName('course1y')[0].value,
                    courseSp: document.getElementsByName('courseSp')[0].value,
                    notes: document.getElementsByName('notes')[0].value, // New Notes field
                    paymentMode: payMode, // New Payment Mode
                    
                    photoData: files[0].data, photoName: files[0].name,
                    docData: files[1].data, docName: files[1].name,
                    payData: files[2].data, payName: files[2].name
                };

                const serialDisplay = document.getElementById('serial-display');
                if(serialDisplay) serialDisplay.innerHTML = '<div class="serial-loader"></div>';

                // --- START UPLOAD ---
                const uploadTask = fetch(SCRIPT_URL, {
                    method: 'POST',
                    body: JSON.stringify(formData)
                }).then(response => response.json());

                // --- START ANIMATION TIMER (2 Seconds) ---
                const timerTask = new Promise(resolve => setTimeout(resolve, 2000));

                timerTask.then(() => {
                    // STOP SPINNING, SHOW GREEN CHECK
                    if(btn) {
                        btn.classList.remove('loading');
                        btn.classList.add('success'); 
                    }

                    // WAIT 1 SECOND (To let user see the Green Check)
                    setTimeout(() => {
                        // NOW SWITCH PAGE
                        document.getElementById('form-section').classList.add('hidden');
                        document.getElementById('success-view').classList.remove('hidden');
                        
                        // HANDLE SERVER RESPONSE
                        uploadTask.then(data => {
                            if(data.status === 'success') {
                                if(serialDisplay) serialDisplay.textContent = data.serial;
                            } else {
                                handleError("Submission Failed: " + data.message);
                            }
                        }).catch(error => {
                            handleError("Network Error: " + error);
                        });
                    }, 1000); 
                });
            });
          });
      }

      function handleError(msg) {
        alert(msg);
        document.getElementById('success-view').classList.add('hidden');
        document.getElementById('form-section').classList.remove('hidden');
        var btn = document.getElementById('submit-btn');
        if(btn) {
            btn.disabled = false; 
            btn.classList.remove('loading');
            btn.classList.remove('success'); 
        }
      }

      function getFileData(id) {
        return new Promise(resolve => {
            var el = document.getElementById(id);
            if(!el || !el.files[0]) resolve({data:null, name:null});
            else {
                var file = el.files[0];
                var reader = new FileReader();
                reader.onload = e => resolve({data:e.target.result, name:file.name});
                reader.readAsDataURL(file);
            }
        });
      }
    </script>
</body>
</html>
